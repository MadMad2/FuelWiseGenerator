{
  "entities": {
    "GeneratorUnit": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "GeneratorUnit",
      "type": "object",
      "description": "Represents a diesel generator unit with its fuel consumption rate and fuel storage.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the GeneratorUnit entity."
        },
        "name": {
          "type": "string",
          "description": "The name or identifier of the generator unit."
        },
        "fuelConsumptionRate": {
          "type": "number",
          "description": "The fuel consumption rate of the generator unit in liters per hour."
        },
        "fuelStorageId": {
          "type": "string",
          "description": "Reference to FuelStorage. (Relationship: GeneratorUnit 1:1 FuelStorage)"
        }
      },
      "required": [
        "id",
        "name",
        "fuelConsumptionRate",
        "fuelStorageId"
      ]
    },
    "FuelStorage": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "FuelStorage",
      "type": "object",
      "description": "Represents the fuel storage associated with a generator unit.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the FuelStorage entity."
        },
        "capacity": {
          "type": "number",
          "description": "The total fuel storage capacity in liters."
        },
        "remainingFuel": {
          "type": "number",
          "description": "The current remaining fuel in the storage in liters."
        }
      },
      "required": [
        "id",
        "capacity",
        "remainingFuel"
      ]
    },
    "UsageRecord": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UsageRecord",
      "type": "object",
      "description": "Represents a record of generator unit usage, including scheduled and on-demand hours.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the UsageRecord entity."
        },
        "generatorUnitId": {
          "type": "string",
          "description": "Reference to GeneratorUnit. (Relationship: GeneratorUnit 1:N UsageRecord)"
        },
        "scheduledHours": {
          "type": "number",
          "description": "The number of hours the generator unit was used for scheduled operations."
        },
        "onDemandHours": {
          "type": "number",
          "description": "The number of hours the generator unit was used for on-demand operations."
        },
        "recordDate": {
          "type": "string",
          "description": "The date of the usage record.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "generatorUnitId",
        "scheduledHours",
        "onDemandHours",
        "recordDate"
      ]
    },
    "Expense": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Expense",
      "type": "object",
      "description": "Represents an expense associated with a generator unit.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Expense entity."
        },
        "generatorUnitId": {
          "type": "string",
          "description": "Reference to GeneratorUnit. (Relationship: GeneratorUnit 1:N Expense)"
        },
        "type": {
          "type": "string",
          "description": "The type of expense (e.g., transportation, maintenance, component replacement)."
        },
        "amount": {
          "type": "number",
          "description": "The amount of the expense."
        },
        "expenseDate": {
          "type": "string",
          "description": "The date of the expense.",
          "format": "date-time"
        },
        "description": {
          "type": "string",
          "description": "A detailed description of the expense."
        }
      },
      "required": [
        "id",
        "generatorUnitId",
        "type",
        "amount",
        "expenseDate"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}/generatorUnits/{generatorUnitId}",
        "definition": {
          "entityName": "GeneratorUnit",
          "schema": {
            "$ref": "#/backend/entities/GeneratorUnit"
          },
          "description": "Stores generator unit details. Ownership is enforced via path-based rules.  The userId is the owner.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the user who owns the generator unit."
            },
            {
              "name": "generatorUnitId",
              "description": "The unique ID of the generator unit."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/fuelStorages/{fuelStorageId}",
        "definition": {
          "entityName": "FuelStorage",
          "schema": {
            "$ref": "#/backend/entities/FuelStorage"
          },
          "description": "Stores fuel storage details. Each generator unit has a 1:1 relationship with a FuelStorage. Storing this under the user path maintains ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the user who owns the fuel storage."
            },
            {
              "name": "fuelStorageId",
              "description": "The unique ID of the fuel storage."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/generatorUnits/{generatorUnitId}/usageRecords/{usageRecordId}",
        "definition": {
          "entityName": "UsageRecord",
          "schema": {
            "$ref": "#/backend/entities/UsageRecord"
          },
          "description": "Stores usage records for each generator unit. Nested under generatorUnits to maintain the 1:N relationship and enforce ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the user who owns the generator unit and the usage record."
            },
            {
              "name": "generatorUnitId",
              "description": "The unique ID of the generator unit to which this usage record belongs."
            },
            {
              "name": "usageRecordId",
              "description": "The unique ID of the usage record."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/generatorUnits/{generatorUnitId}/expenses/{expenseId}",
        "definition": {
          "entityName": "Expense",
          "schema": {
            "$ref": "#/backend/entities/Expense"
          },
          "description": "Stores expenses associated with each generator unit. Nested under generatorUnits to maintain the 1:N relationship and enforce ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the user who owns the generator unit and the expense."
            },
            {
              "name": "generatorUnitId",
              "description": "The unique ID of the generator unit to which this expense belongs."
            },
            {
              "name": "expenseId",
              "description": "The unique ID of the expense."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to manage diesel generator units, their fuel storage, usage records, and associated expenses. It prioritizes authorization independence and data clarity.\n\nThe core structure revolves around users and their generator units. Each user owns their generator units and related data. This ownership is enforced through path-based security rules, eliminating the need for complex `get()` calls in the rules.\n\n*   `/users/{userId}/generatorUnits/{generatorUnitId}`: Stores the generator unit details.  The `userId` ensures ownership.  The `generatorUnitId` is used to uniquely identify each unit.\n*   `/users/{userId}/fuelStorages/{fuelStorageId}`: Stores fuel storage details. Each generator unit has a 1:1 relationship with a FuelStorage. Storing this under the user path maintains ownership.\n*   `/users/{userId}/generatorUnits/{generatorUnitId}/usageRecords/{usageRecordId}`: Stores the usage records for each generator unit. The nested structure under `generatorUnits` maintains the 1:N relationship and enforces ownership.\n*   `/users/{userId}/generatorUnits/{generatorUnitId}/expenses/{expenseId}`: Stores expenses associated with each generator unit. The nested structure under `generatorUnits` maintains the 1:N relationship and enforces ownership.\n\n**Authorization Independence**: Achieved by using path-based ownership. Security rules can directly check if `request.auth.uid == userId` to grant access to the entire `/users/{userId}` subtree, eliminating the need to fetch parent documents. This ensures atomic operations and simpler rules.\n\n**QAPs (Rules are not Filters)**:  The path-based ownership (`/users/{userId}/...`) enables secure list operations. Rules can efficiently filter based on `userId` without reading the documents' contents. Structural Segregation of data by ownership guarantees that all documents within a collection share the same security requirements."
  }
}